{"version":3,"sources":["webpack:///./src/ui/src/components/FormulaOverlay/FormulaOverlay.scss?e349","webpack:///./src/ui/src/components/FormulaOverlay/FormulaOverlay.scss","webpack:///./src/ui/src/components/FormulaHelperOverlay/FormulaHelperOverlay.scss?d503","webpack:///./src/ui/src/components/FormulaHelperOverlay/FormulaHelperOverlay.scss","webpack:///./src/ui/src/components/FormulaBar/FormulaBar.scss?20b1","webpack:///./src/ui/src/components/FormulaBar/FormulaBar.scss","webpack:///./src/ui/src/components/FormulaHelperOverlay/FormulaHelperOverlay.js","webpack:///./src/ui/src/components/FormulaHelperOverlay/index.js","webpack:///./src/ui/src/components/FormulaOverlay/FormulaOverlay.js","webpack:///./src/ui/src/components/FormulaBar/FormulaBar.js","webpack:///./src/ui/src/components/FormulaBar/FormulaBarContainer.js","webpack:///./src/ui/src/components/FormulaBar/index.js"],"names":["api","content","__esModule","default","module","i","options","styleTag","window","isApryseWebViewerWebComponent","document","head","appendChild","webComponents","getElementsByTagName","length","findNestedWebComponents","tagName","root","elements","querySelectorAll","forEach","el","push","shadowRoot","clonedStyleTags","webComponent","onload","styleNode","innerHTML","cloneNode","exports","locals","FormulaHelperOverlay","props","_selectedFormula$para","selectedFormula","labelId","t","useTranslation","formulaLabel","name","formulaParameters","parameters","map","param","concat","React","createElement","className","aria-labelledby","join","propTypes","PropTypes","object","string","FormulaOverlay","_ref","isOpen","onSelect","onClose","triggerElement","highlightedIndex","setHighlightedIndex","id","overlayRef","useRef","optionRefs","useEffect","current","scrollIntoView","behavior","block","handleClickOutside","useCallback","e","contains","target","useOnClickOutside","DataElementWrapper","dataElement","DataElements","FORMULA_OVERLAY","ref","role","option","index","key","classNames","onClick","onMouseEnter","aria-selected","tabIndex","description","isRequired","bool","arrayOf","shape","func","instanceOf","Element","number","FormulaBar","isReadOnly","activeCellRange","cellFormula","stringCellValue","onRangeInputChange","onRangeInputKeyDown","formulaBarValue","_useState2","_slicedToArray","useState","inputValue","setInputValue","_useState4","showOverlay","setShowOverlay","_useState6","_useState8","setSelectedFormula","_useState0","formulaSearchResults","setFormulaSearchResults","_useState10","formulaSegments","setFormulaSegments","_useState12","isFormulaFocused","setIsFormulaFocused","formulaInputRef","formulaBarProviderRef","lastCellRef","spreadsheetEditorManager","core","getDocumentViewer","getSpreadsheetEditorManager","setProvider","getFormulaBarProvider","addEventListener","removeEventListener","handleFormulaSearchEvent","event","_event$getFormulaInfo","_event$getFormulaInfo2","items","getFormulaInfoItems","call","handleFormulaBarTextChanged","segments","getInfo","updatedText","segment","_text","handleFormulaBarSelectionChangedEvent","_formulaInputRef$curr","_formulaInputRef$curr2","focus","inputPosition","getSelectionPosition","setSelectionRange","handleFormulaHelpEvent","getFormulaInfo","currentCell","handleOptionSelect","onFormulaBarSelectFormula","onFormulaBarTextChange","handleOverlayClose","handleInputChange","value","onFormulaBarSelectionChanged","selectionStart","handleInputFocus","onFormulaBarFocus","overlayID","FORMULA_BAR","handleKeyDown","preventDefault","prev","shiftKey","stopPropagation","onFormulaBarKeyDown","type","onChange","onKeyDown","aria-label","readOnly","Icon","glyph","item","text","style","color","onFocus","aria-autocomplete","aria-expanded","aria-controls","hasFormula","aria-activedescendant","undefined","onBlur","_e$relatedTarget","relatedTarget","closest","oneOfType","EDIT_MODE","Core","SpreadsheetEditor","SpreadsheetEditorEditMode","FormulaBarContainer","useSelector","selectors","getActiveCellRange","getCellFormula","getStringCellValue","isReadOnlyMode","getSpreadsheetEditorEditMode","VIEW_ONLY","rangeInputValue","setRangeInputValue","spreadsheetEditorDocument","getDocument","getSpreadsheetEditorDocument","cellRange","getCellRange","selectCellRange","console","error"],"mappings":"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","file":"chunks/chunk.48.js","sourcesContent":["var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./FormulaOverlay.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function(styleTag) {\n                function findNestedWebComponents(tagName, root = document) {\n                  const elements = [];\n\n                  // Check direct children\n                  root.querySelectorAll(tagName).forEach((el) => elements.push(el));\n\n                  // Check shadow DOMs\n                  root.querySelectorAll('*').forEach((el) => {\n                    if (el.shadowRoot) {\n                      elements.push(...findNestedWebComponents(tagName, el.shadowRoot));\n                    }\n                  });\n\n                  return elements;\n                }\n                if (!window.isApryseWebViewerWebComponent) {\n                  document.head.appendChild(styleTag);\n                  return;\n                }\n\n                let webComponents;\n                // First we see if the webcomponent is at the document level\n                webComponents = document.getElementsByTagName('apryse-webviewer');\n                // If not, we check have to check if it is nested in another webcomponent\n                if (!webComponents.length) {\n                  webComponents = findNestedWebComponents('apryse-webviewer');\n                }\n                // Now we append the style tag to each webcomponent\n                const clonedStyleTags = [];\n                for (let i = 0; i < webComponents.length; i++) {\n                  const webComponent = webComponents[i];\n                  if (i === 0) {\n                    webComponent.shadowRoot.appendChild(styleTag);\n                    styleTag.onload = function() {\n                      if (clonedStyleTags.length > 0) {\n                        clonedStyleTags.forEach((styleNode) => {\n                          // eslint-disable-next-line no-unsanitized/property\n                          styleNode.innerHTML = styleTag.innerHTML;\n                        });\n                      }\n                    };\n                  } else {\n                    const styleNode = styleTag.cloneNode(true);\n                    webComponent.shadowRoot.appendChild(styleNode);\n                    clonedStyleTags.push(styleNode);\n                  }\n                }\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".FormulaOverlay{max-height:320px;width:320px;position:absolute;inset-block-start:100%;inset-inline-start:0;background:var(--component-background);z-index:90;list-style:none;margin:0;padding:var(--padding-tiny) 0;box-shadow:0 0 3px 0 var(--box-shadow);border-radius:var(--border-radius);overflow-x:hidden;overflow-y:auto}.FormulaOverlay .formula-label{display:flex;font-weight:var(--font-weight-bold);height:28px;padding:var(--padding-tiny) var(--padding-small);line-height:20px}.FormulaOverlay .formula-overlay-list{list-style:none;padding:0;margin:0}.FormulaOverlay .formula-option{cursor:pointer;display:flex;flex-direction:column;padding:var(--padding-tiny) var(--padding-small);height:32px;line-height:20px}.FormulaOverlay .formula-option .formula-description{font-size:10px;color:var(--text-secondary);line-height:16px}.FormulaOverlay .formula-option.highlighted{background-color:var(--dropdown-item-hover);color:var(--dropdown-item-active-text);height:44px}.FormulaOverlay .formula-option.highlighted .formula-name{font-weight:var(--font-weight-bold)}\", \"\"]);\n\n// exports\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./FormulaHelperOverlay.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function(styleTag) {\n                function findNestedWebComponents(tagName, root = document) {\n                  const elements = [];\n\n                  // Check direct children\n                  root.querySelectorAll(tagName).forEach((el) => elements.push(el));\n\n                  // Check shadow DOMs\n                  root.querySelectorAll('*').forEach((el) => {\n                    if (el.shadowRoot) {\n                      elements.push(...findNestedWebComponents(tagName, el.shadowRoot));\n                    }\n                  });\n\n                  return elements;\n                }\n                if (!window.isApryseWebViewerWebComponent) {\n                  document.head.appendChild(styleTag);\n                  return;\n                }\n\n                let webComponents;\n                // First we see if the webcomponent is at the document level\n                webComponents = document.getElementsByTagName('apryse-webviewer');\n                // If not, we check have to check if it is nested in another webcomponent\n                if (!webComponents.length) {\n                  webComponents = findNestedWebComponents('apryse-webviewer');\n                }\n                // Now we append the style tag to each webcomponent\n                const clonedStyleTags = [];\n                for (let i = 0; i < webComponents.length; i++) {\n                  const webComponent = webComponents[i];\n                  if (i === 0) {\n                    webComponent.shadowRoot.appendChild(styleTag);\n                    styleTag.onload = function() {\n                      if (clonedStyleTags.length > 0) {\n                        clonedStyleTags.forEach((styleNode) => {\n                          // eslint-disable-next-line no-unsanitized/property\n                          styleNode.innerHTML = styleTag.innerHTML;\n                        });\n                      }\n                    };\n                  } else {\n                    const styleNode = styleTag.cloneNode(true);\n                    webComponent.shadowRoot.appendChild(styleNode);\n                    clonedStyleTags.push(styleNode);\n                  }\n                }\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".FormulaHelperOverlay .formulaHelperOverlayValue{display:inline-block;padding:var(--padding-tiny) var(--padding-small)}\", \"\"]);\n\n// exports\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./FormulaBar.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function(styleTag) {\n                function findNestedWebComponents(tagName, root = document) {\n                  const elements = [];\n\n                  // Check direct children\n                  root.querySelectorAll(tagName).forEach((el) => elements.push(el));\n\n                  // Check shadow DOMs\n                  root.querySelectorAll('*').forEach((el) => {\n                    if (el.shadowRoot) {\n                      elements.push(...findNestedWebComponents(tagName, el.shadowRoot));\n                    }\n                  });\n\n                  return elements;\n                }\n                if (!window.isApryseWebViewerWebComponent) {\n                  document.head.appendChild(styleTag);\n                  return;\n                }\n\n                let webComponents;\n                // First we see if the webcomponent is at the document level\n                webComponents = document.getElementsByTagName('apryse-webviewer');\n                // If not, we check have to check if it is nested in another webcomponent\n                if (!webComponents.length) {\n                  webComponents = findNestedWebComponents('apryse-webviewer');\n                }\n                // Now we append the style tag to each webcomponent\n                const clonedStyleTags = [];\n                for (let i = 0; i < webComponents.length; i++) {\n                  const webComponent = webComponents[i];\n                  if (i === 0) {\n                    webComponent.shadowRoot.appendChild(styleTag);\n                    styleTag.onload = function() {\n                      if (clonedStyleTags.length > 0) {\n                        clonedStyleTags.forEach((styleNode) => {\n                          // eslint-disable-next-line no-unsanitized/property\n                          styleNode.innerHTML = styleTag.innerHTML;\n                        });\n                      }\n                    };\n                  } else {\n                    const styleNode = styleTag.cloneNode(true);\n                    webComponent.shadowRoot.appendChild(styleNode);\n                    clonedStyleTags.push(styleNode);\n                  }\n                }\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".FormulaBar{display:flex;border:1px solid var(--gray-5);background-color:var(--gray-2);padding:8px;grid-gap:8px;gap:8px;border-bottom:1px solid #e0e0e0;position:relative}.FormulaBar .RangeInput{padding:6px 8px}.FormulaBar .RangeInput.focus-visible,.FormulaBar .RangeInput:focus-visible{outline:var(--focus-visible-outline)!important}.FormulaBar .Formula{display:flex;align-items:center;flex-grow:1;height:32px;position:relative;border:1px solid var(--border);border-radius:4px;background-color:var(--component-background);padding-inline-start:30px}.FormulaBar .Formula .FormulaInput{position:relative;z-index:1;flex-grow:1;width:100%;padding:6px 8px;border:none;outline:none;font-size:14px;background-color:transparent}.FormulaBar .Formula .FormulaInput.hasFormula{color:transparent;caret-color:var(--gray-13)}.FormulaBar .Formula .FormulaOverlay{transform:translateX(38px);transform-origin:left top}.FormulaBar .Formula.readOnly{border-color:var(--lighter-border)}.FormulaBar .Formula[focus-within]{outline:var(--focus-visible-outline)!important}.FormulaBar .Formula:focus-within{outline:var(--focus-visible-outline)!important}.FormulaBar .Formula .FormulaInputMask{position:absolute;inset-block-start:0;padding:6px 8px;color:transparent;pointer-events:none;white-space:pre-wrap;width:100%;padding-inline-start:8px;font-size:14px;z-index:0}.FormulaBar .FormulaIcon{position:absolute;inset-inline-start:8px}.FormulaBar .FormulaIcon.readOnly{color:var(--disabled-icon)}.FormulaBar .FormulaInput{flex-grow:1;width:100%;padding:6px 8px;border:none;outline:none;background-color:transparent}\", \"\"]);\n\n// exports\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport './FormulaHelperOverlay.scss';\n\nconst FormulaHelperOverlay = (props) => {\n  const { selectedFormula, labelId } = props;\n  const { t } = useTranslation();\n\n  const formulaLabel = selectedFormula?.name || '';\n  const formulaParameters = selectedFormula?.parameters?.map((param) =>\n    t(`formulas.${selectedFormula.name}.parameters.${param.name}.name`, param.name)\n  ) || [];\n\n  return (\n    <div className=\"FormulaHelperOverlay\" aria-labelledby={labelId}>\n      <span className=\"formulaHelperOverlayValue\">\n        {formulaLabel}({formulaParameters.join(', ')})\n      </span>\n    </div>\n  );\n};\n\nFormulaHelperOverlay.propTypes = {\n  selectedFormula: PropTypes.object,\n  labelId: PropTypes.string,\n};\n\nexport default FormulaHelperOverlay;","import FormulaHelperOverlay from './FormulaHelperOverlay';\n\nexport default FormulaHelperOverlay;","import React, { useCallback, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport useOnClickOutside from 'hooks/useOnClickOutside';\nimport { useTranslation } from 'react-i18next';\nimport './FormulaOverlay.scss';\nimport FormulaHelperOverlay from '../FormulaHelperOverlay';\nimport DataElementWrapper from '../DataElementWrapper';\nimport DataElements from 'constants/dataElement';\n\nconst FormulaOverlay = ({\n  isOpen,\n  options,\n  onSelect,\n  onClose,\n  triggerElement,\n  highlightedIndex,\n  setHighlightedIndex,\n  selectedFormula,\n  id,\n}) => {\n  const { t } = useTranslation();\n  const overlayRef = useRef(null);\n  const optionRefs = useRef([]);\n\n  useEffect(() => {\n    if (optionRefs.current[highlightedIndex]) {\n      optionRefs.current[highlightedIndex].scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest',\n      });\n    }\n  }, [highlightedIndex]);\n\n  const handleClickOutside = useCallback((e) => {\n    if (isOpen && !triggerElement?.contains(e.target)) {\n      onClose();\n    }\n  }, [isOpen, onClose, triggerElement]);\n\n  useOnClickOutside(overlayRef, handleClickOutside);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <DataElementWrapper dataElement={DataElements.FORMULA_OVERLAY} className=\"FormulaOverlay\">\n      <span id='formula-overlay-label' className='formula-label'>\n        {t('formulaBar.formulas')}\n      </span>\n      {!selectedFormula && (\n        <ul\n          ref={overlayRef}\n          className=\"formula-overlay-list\"\n          role=\"listbox\"\n          aria-labelledby=\"formula-overlay-label\"\n          id={id}\n        >\n          {options.map((option, index) => (\n            <li\n              key={`${option.name}-${index}`}\n              ref={(el) => (optionRefs.current[index] = el)}\n              className={classNames('formula-option', {\n                'highlighted': highlightedIndex === index,\n              })}\n              onClick={() => onSelect(option)}\n              onMouseEnter={() => setHighlightedIndex(index)}\n              id={`option-${index}`}\n              role=\"option\"\n              aria-labelledby={`formula-name-${index} formula-desc-${index}`}\n              aria-selected={highlightedIndex === index}\n              tabIndex={0}\n            >\n              <div id={`formula-name-${index}`} className=\"formula-name\">{option.name}</div>\n              {highlightedIndex === index && (\n                <div id={`formula-desc-${index}`} className=\"formula-description\">\n                  {t(`formulas.${option.name}.description`, option.description)}\n                </div>\n              )}\n            </li>\n          ))}\n        </ul>\n      )}\n      {selectedFormula && (\n        <FormulaHelperOverlay\n          selectedFormula={selectedFormula}\n          labelId=\"formula-overlay-label\"\n        />\n      )}\n    </DataElementWrapper>\n  );\n};\n\nFormulaOverlay.propTypes = {\n  id: PropTypes.string.isRequired,\n  isOpen: PropTypes.bool.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      description: PropTypes.string.isRequired,\n    })\n  ).isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  triggerElement: PropTypes.instanceOf(Element),\n  highlightedIndex: PropTypes.number.isRequired,\n  setHighlightedIndex: PropTypes.func.isRequired,\n  selectedFormula: PropTypes.shape({\n    name: PropTypes.string,\n    description: PropTypes.string.isRequired,\n    parameters: PropTypes.arrayOf(\n      PropTypes.shape({\n        name: PropTypes.string,\n      })\n    ),\n  }),\n};\n\nexport default FormulaOverlay;\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { useTranslation } from 'react-i18next';\nimport Icon from 'components/Icon';\nimport DataElements from 'constants/dataElement';\nimport DataElementWrapper from 'components/DataElementWrapper';\nimport FormulaOverlay from 'components/FormulaOverlay/FormulaOverlay';\nimport core from 'core';\nimport './FormulaBar.scss';\n\nconst FormulaBar = (props) => {\n  const {\n    isReadOnly,\n    activeCellRange,\n    cellFormula,\n    stringCellValue,\n    onRangeInputChange,\n    onRangeInputKeyDown,\n  } = props;\n\n  const { t } = useTranslation();\n  const formulaBarValue = cellFormula || stringCellValue || '';\n\n  const [inputValue, setInputValue] = useState(formulaBarValue);\n  const [showOverlay, setShowOverlay] = useState(false);\n  const [highlightedIndex, setHighlightedIndex] = useState(0);\n  const [selectedFormula, setSelectedFormula] = useState(null);\n  const [formulaSearchResults, setFormulaSearchResults] = useState([]);\n  const [formulaSegments, setFormulaSegments] = useState([]);\n  const [isFormulaFocused, setIsFormulaFocused] = useState(false);\n\n  const formulaInputRef = useRef(null);\n  const formulaBarProviderRef = useRef(null);\n  const lastCellRef = useRef();\n\n  const spreadsheetEditorManager = core.getDocumentViewer().getSpreadsheetEditorManager();\n\n  useEffect(() => {\n    function setProvider() {\n      formulaBarProviderRef.current = spreadsheetEditorManager.getFormulaBarProvider();\n    }\n\n    core.addEventListener('spreadsheetEditorReady', setProvider);\n\n    return () => {\n      core.removeEventListener('spreadsheetEditorReady', setProvider);\n    };\n  }, [spreadsheetEditorManager]);\n\n  useEffect(() => {\n    const handleFormulaSearchEvent = (event) => {\n      if (!isFormulaFocused) {\n        return;\n      }\n\n      const items = event.getFormulaInfoItems?.() ?? [];\n      setFormulaSearchResults(items);\n      setHighlightedIndex(0);\n    };\n\n    core.addEventListener('formulaSearchEvent', handleFormulaSearchEvent);\n\n    return () => {\n      core.removeEventListener('formulaSearchEvent', handleFormulaSearchEvent);\n    };\n  }, [isFormulaFocused]);\n\n  useEffect(() => {\n    const handleFormulaBarTextChanged = (event) => {\n      const segments = event.getInfo();\n      setFormulaSegments(segments);\n\n      const updatedText = segments.map((segment) => segment._text).join('');\n      setInputValue(updatedText);\n    };\n\n    const handleFormulaBarSelectionChangedEvent = (event) => {\n      formulaInputRef.current?.focus();\n      const inputPosition = event.getSelectionPosition();\n      formulaInputRef.current?.setSelectionRange(inputPosition, inputPosition);\n    };\n\n    const handleFormulaHelpEvent = (event) => {\n      setSelectedFormula(event.getFormulaInfo());\n    };\n\n    core.addEventListener('formulaBarTextChangedEvent', handleFormulaBarTextChanged);\n    core.addEventListener('formulaBarSelectionChangedEvent', handleFormulaBarSelectionChangedEvent);\n    core.addEventListener('formulaHelpEvent', handleFormulaHelpEvent);\n\n    return () => {\n      core.removeEventListener('formulaBarTextChangedEvent', handleFormulaBarTextChanged);\n      core.removeEventListener('formulaBarSelectionChangedEvent', handleFormulaBarSelectionChangedEvent);\n      core.removeEventListener('formulaHelpEvent', handleFormulaHelpEvent);\n    };\n  }, []);\n\n  useEffect(() => {\n    const currentCell = activeCellRange;\n    if (lastCellRef.current !== currentCell) {\n      setInputValue(formulaBarValue);\n      lastCellRef.current = currentCell;\n    }\n  }, [activeCellRange, formulaBarValue]);\n\n  const handleOptionSelect = useCallback((option) => {\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectFormula(option.name);\n      formulaBarProviderRef.current.onFormulaBarTextChange(option.name);\n    }\n  }, []);\n\n  const handleOverlayClose = useCallback(() => {\n    setShowOverlay(false);\n  }, []);\n\n  const handleInputChange = useCallback((e) => {\n    const value = e.target.value;\n    setInputValue(value);\n    setFormulaSegments([]);\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectionChanged(formulaInputRef.current.selectionStart);\n      formulaBarProviderRef.current.onFormulaBarTextChange(value);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (formulaSearchResults.length === 0 && !selectedFormula || !isFormulaFocused) {\n      setShowOverlay(false);\n    } else {\n      setShowOverlay(true);\n    }\n  }, [formulaSearchResults, selectedFormula]);\n\n  const handleInputFocus = useCallback(() => {\n    setIsFormulaFocused(true);\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarFocus();\n    }\n  }, []);\n\n  const overlayID = `formula-overlay-${DataElements.FORMULA_BAR}`;\n\n  const handleInputBlur = (e) => {\n    if (showOverlay && !e.relatedTarget?.closest(`#${overlayID}`)) {\n      handleOverlayClose();\n    }\n    setIsFormulaFocused(false);\n  };\n\n  const handleKeyDown = useCallback((e) => {\n    if (showOverlay && !isReadOnly) {\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setHighlightedIndex((prev) => (prev + 1) % formulaSearchResults.length);\n          return;\n        case 'ArrowUp':\n          e.preventDefault();\n          setHighlightedIndex((prev) => (prev - 1 + formulaSearchResults.length) % formulaSearchResults.length);\n          return;\n        case 'Enter':\n          if (formulaSearchResults[highlightedIndex]) {\n            handleOptionSelect(formulaSearchResults[highlightedIndex]);\n            return;\n          }\n          break;\n        case 'Tab':\n          if (!e.shiftKey) {\n            e.preventDefault();\n            if (formulaSearchResults[highlightedIndex]) {\n              handleOptionSelect(formulaSearchResults[highlightedIndex]);\n            }\n            return;\n          }\n          break;\n        case 'Escape':\n          e.stopPropagation();\n          handleOverlayClose();\n          return;\n        default:\n          break;\n      }\n    }\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectionChanged(formulaInputRef.current.selectionStart);\n      formulaBarProviderRef.current.onFormulaBarKeyDown(e);\n    }\n  }, [showOverlay, isReadOnly, formulaSearchResults, highlightedIndex, handleOptionSelect, handleOverlayClose]);\n\n  return (\n    <DataElementWrapper className='FormulaBar' dataElement={DataElements.FORMULA_BAR}>\n      <input\n        type=\"text\"\n        className='RangeInput'\n        value={activeCellRange}\n        onChange={(e) => onRangeInputChange(e.target.value)}\n        onKeyDown={onRangeInputKeyDown}\n        aria-label={t('formulaBar.range')}\n      />\n      <div className={classNames('Formula', { readOnly: isReadOnly })}>\n        <Icon glyph=\"function\" className={classNames('FormulaIcon', { readOnly: isReadOnly })} />\n        <div className='FormulaInputMask'>\n          {\n            formulaSegments.map((item, index) => {\n              return (<span key={`${item.text}-${index}`} style={{ color: item.color }}>{item.text}</span>);\n            })\n          }\n        </div>\n        <input\n          onFocus={handleInputFocus}\n          id={DataElements.FORMULA_BAR}\n          ref={formulaInputRef}\n          type=\"text\"\n          role=\"combobox\"\n          aria-autocomplete=\"list\"\n          aria-expanded={formulaSearchResults.length > 0}\n          aria-controls={overlayID}\n          className={classNames({\n            'FormulaInput': true,\n            hasFormula: formulaSegments.length > 0,\n          })}\n          aria-activedescendant={showOverlay && highlightedIndex !== -1 ? `option-${highlightedIndex}` : undefined}\n          value={inputValue}\n          onChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onKeyDown={handleKeyDown}\n          readOnly={isReadOnly}\n          aria-label={t('formulaBar.label')}\n        />\n        {showOverlay && !isReadOnly && (\n          <FormulaOverlay\n            isOpen={showOverlay}\n            options={formulaSearchResults}\n            onSelect={handleOptionSelect}\n            onClose={handleOverlayClose}\n            triggerElement={formulaInputRef.current}\n            highlightedIndex={highlightedIndex}\n            setHighlightedIndex={setHighlightedIndex}\n            selectedFormula={selectedFormula}\n            id={overlayID}\n          />\n        )}\n      </div>\n    </DataElementWrapper>\n  );\n};\n\nFormulaBar.propTypes = {\n  isReadOnly: PropTypes.bool,\n  activeCellRange: PropTypes.string,\n  cellFormula: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  stringCellValue: PropTypes.string,\n  onRangeInputChange: PropTypes.func,\n  onRangeInputKeyDown: PropTypes.func,\n};\n\nexport default FormulaBar;\n","import React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport selectors from 'selectors';\nimport FormulaBar from './FormulaBar';\nimport core from 'core';\n\nconst EDIT_MODE = window.Core.SpreadsheetEditor.SpreadsheetEditorEditMode;\n\nexport const FormulaBarContainer = () => {\n  // This component can pull all Redux state and call any core methods\n  const activeCellRange = useSelector(selectors.getActiveCellRange);\n  const cellFormula = useSelector(selectors.getCellFormula);\n  const stringCellValue = useSelector(selectors.getStringCellValue);\n  const spreadsheetEditorEditMode = useSelector(selectors.getSpreadsheetEditorEditMode);\n  const isReadOnlyMode = spreadsheetEditorEditMode === EDIT_MODE.VIEW_ONLY;\n\n  const [rangeInputValue, setRangeInputValue] = useState(activeCellRange);\n\n  const onRangeInputChange = (value) => {\n    setRangeInputValue(value);\n  };\n\n  const onRangeInputKeyDown = (event) => {\n    if (event.key === 'Enter') {\n      try {\n        const documentViewer = core.getDocumentViewer();\n        const spreadsheetEditorDocument = documentViewer.getDocument().getSpreadsheetEditorDocument();\n        const cellRange = core.getCellRange(event.target.value);\n        spreadsheetEditorDocument.selectCellRange(cellRange);\n      } catch (e) {\n        setRangeInputValue(activeCellRange);\n        console.error(e);\n        return;\n      }\n    }\n  };\n\n  useEffect(() => {\n    setRangeInputValue(activeCellRange);\n  }, [activeCellRange]);\n\n  return (\n    <FormulaBar\n      isReadOnly={isReadOnlyMode}\n      activeCellRange={rangeInputValue}\n      cellFormula={cellFormula}\n      stringCellValue={stringCellValue}\n      onRangeInputChange={onRangeInputChange}\n      onRangeInputKeyDown={onRangeInputKeyDown}\n    />\n  );\n};\n\nexport default FormulaBarContainer;","import FormulaBarContainer from './FormulaBarContainer';\nexport default FormulaBarContainer;"],"sourceRoot":""}